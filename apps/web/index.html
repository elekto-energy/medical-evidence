<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVE Medical Evidence</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0f; color: #e0e0e0; min-height: 100vh; }
    .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
    
    header { text-align: center; margin-bottom: 30px; }
    .logo { font-size: 2.2rem; font-weight: 700; background: linear-gradient(135deg, #00d4aa, #0099ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: #888; font-size: 0.95rem; margin-top: 4px; }
    .badges { margin-top: 12px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 500; }
    .badge.patent { background: rgba(0, 212, 170, 0.1); border: 1px solid rgba(0, 212, 170, 0.3); color: #00d4aa; }
    .badge.verified { background: rgba(0, 153, 255, 0.1); border: 1px solid rgba(0, 153, 255, 0.3); color: #0099ff; }
    
    .stats-bar { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .stats-item { background: #12121a; border: 1px solid #1e1e2e; border-radius: 10px; padding: 12px 20px; text-align: center; }
    .stats-value { font-size: 1.4rem; font-weight: 700; color: #00d4aa; }
    .stats-label { font-size: 0.7rem; color: #666; margin-top: 2px; }
    
    .master-view { background: #12121a; border: 1px solid #1e1e2e; border-radius: 16px; overflow: hidden; }
    .master-header { padding: 16px 20px; border-bottom: 1px solid #1e1e2e; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
    .master-title { font-size: 1rem; font-weight: 600; }
    .master-subtitle { font-size: 0.8rem; color: #666; margin-top: 4px; }
    .filters { display: flex; gap: 10px; flex-wrap: wrap; }
    .filter-group { display: flex; align-items: center; gap: 6px; }
    .filter-label { font-size: 0.75rem; color: #888; }
    select { background: #1a1a25; border: 1px solid #2a2a3a; border-radius: 6px; padding: 6px 10px; color: #fff; font-size: 0.8rem; cursor: pointer; }
    select:focus { border-color: #00d4aa; outline: none; }
    
    .substances-table { width: 100%; border-collapse: collapse; }
    .substances-table th { text-align: left; padding: 12px 16px; font-size: 0.75rem; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #1e1e2e; }
    .substances-table td { padding: 14px 16px; border-bottom: 1px solid #1a1a25; font-size: 0.85rem; }
    .substances-table tr { cursor: pointer; transition: background 0.15s; }
    .substances-table tr:hover { background: #1a1a25; }
    .drug-name { font-weight: 600; color: #fff; text-transform: capitalize; }
    
    .atc-badge { display: inline-block; width: 24px; height: 24px; line-height: 24px; text-align: center; border-radius: 6px; font-size: 0.7rem; font-weight: 700; margin-right: 8px; }
    .atc-A { background: rgba(255, 180, 0, 0.2); color: #ffb400; }
    .atc-C { background: rgba(255, 100, 100, 0.2); color: #ff6464; }
    .atc-N { background: rgba(180, 100, 255, 0.2); color: #b464ff; }
    .atc-M { background: rgba(0, 180, 255, 0.2); color: #00b4ff; }
    .atc-J { background: rgba(100, 255, 180, 0.2); color: #64ffb4; }
    .atc-R { background: rgba(255, 180, 200, 0.2); color: #ffb4c8; }
    
    .verified-badge { background: rgba(0, 212, 170, 0.15); color: #00d4aa; padding: 3px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 600; }
    
    .detail-view { display: none; }
    .detail-view.active { display: block; }
    .master-view.hidden { display: none; }
    
    .back-button { background: #1a1a25; border: 1px solid #2a2a3a; border-radius: 8px; padding: 8px 16px; color: #888; font-size: 0.85rem; cursor: pointer; margin-bottom: 16px; display: inline-flex; align-items: center; gap: 6px; }
    .back-button:hover { border-color: #00d4aa; color: #00d4aa; }
    
    .detail-card { background: #12121a; border: 1px solid #1e1e2e; border-radius: 16px; overflow: hidden; }
    .detail-header { padding: 20px 24px; border-bottom: 1px solid #1e1e2e; display: flex; justify-content: space-between; align-items: center; }
    .detail-title { font-size: 1.6rem; font-weight: 700; text-transform: capitalize; display: flex; align-items: center; gap: 12px; }
    .detail-meta { font-size: 0.8rem; color: #666; text-align: right; }
    .detail-body { padding: 24px; }
    
    .detail-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .detail-stat { background: #1a1a25; border-radius: 10px; padding: 14px; text-align: center; }
    .detail-stat-value { font-size: 1.3rem; font-weight: 700; color: #00d4aa; }
    .detail-stat-value.fatal { color: #ff6b6b; }
    .detail-stat-label { font-size: 0.7rem; color: #666; margin-top: 4px; }
    
    .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .chart-card { background: #1a1a25; border-radius: 10px; padding: 16px; }
    .chart-title { font-size: 0.85rem; font-weight: 600; color: #aaa; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
    
    .bar-chart { display: flex; flex-direction: column; gap: 8px; }
    .bar-row { display: flex; align-items: center; gap: 10px; }
    .bar-label { width: 90px; font-size: 0.75rem; color: #888; text-align: right; flex-shrink: 0; }
    .bar-container { flex: 1; height: 20px; background: #0a0a0f; border-radius: 4px; overflow: hidden; position: relative; }
    .bar-fill { height: 100%; border-radius: 4px; transition: width 0.4s ease; }
    .bar-fill.serious { background: linear-gradient(90deg, #ff6b6b, #ff8888); }
    .bar-fill.non-serious { background: linear-gradient(90deg, #00d4aa, #00f0c0); }
    .bar-fill.male { background: linear-gradient(90deg, #0099ff, #00bbff); }
    .bar-fill.female { background: linear-gradient(90deg, #ff69b4, #ff99cc); }
    .bar-fill.unknown { background: linear-gradient(90deg, #555, #777); }
    .bar-fill.default { background: linear-gradient(90deg, #00d4aa, #0099ff); }
    .bar-fill.fatal { background: linear-gradient(90deg, #ff4444, #ff6666); }
    .bar-fill.recovered { background: linear-gradient(90deg, #00d4aa, #00f0c0); }
    .bar-value { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); font-size: 0.7rem; font-weight: 600; color: #fff; }
    .bar-value.outside { right: auto; left: calc(100% + 6px); color: #666; }
    
    .reactions-section { margin-bottom: 24px; }
    .section-title { font-size: 0.9rem; font-weight: 600; color: #aaa; margin-bottom: 10px; }
    .reaction-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .reaction-tag { background: #1a1a25; border: 1px solid #2a2a3a; border-radius: 6px; padding: 6px 10px; font-size: 0.8rem; cursor: pointer; transition: all 0.15s; }
    .reaction-tag:hover { border-color: #00d4aa; background: #1f1f2a; }
    .reaction-count { color: #00d4aa; margin-left: 4px; font-weight: 600; }
    
    .verification-section { background: #1a1a25; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
    .hash-display { background: #0a0a0f; border-radius: 6px; padding: 10px 12px; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.65rem; color: #555; word-break: break-all; margin-top: 8px; }
    .hash-label { color: #00d4aa; }
    
    .disclaimer { background: rgba(255, 180, 0, 0.08); border: 1px solid rgba(255, 180, 0, 0.2); border-radius: 8px; padding: 12px 16px; font-size: 0.8rem; color: #cc9900; }
    .stats-disclaimer { font-size: 0.7rem; color: #555; text-align: center; margin: 16px 0; font-style: italic; }
    
    /* Drawer */
    .drawer-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s; }
    .drawer-overlay.open { opacity: 1; visibility: visible; }
    
    .drawer { position: fixed; top: 0; right: 0; width: 480px; max-width: 90vw; height: 100vh; background: #12121a; border-left: 1px solid #1e1e2e; z-index: 101; transform: translateX(100%); transition: transform 0.3s ease; overflow-y: auto; }
    .drawer.open { transform: translateX(0); }
    
    .drawer-header { padding: 20px; border-bottom: 1px solid #1e1e2e; display: flex; justify-content: space-between; align-items: flex-start; position: sticky; top: 0; background: #12121a; }
    .drawer-title { font-size: 1.1rem; font-weight: 600; }
    .drawer-subtitle { font-size: 0.8rem; color: #888; margin-top: 4px; }
    .drawer-close { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; }
    .drawer-close:hover { color: #fff; }
    
    .drawer-body { padding: 20px; }
    
    .drawer-stats { display: flex; gap: 12px; margin-bottom: 20px; }
    .drawer-stat { background: #1a1a25; border-radius: 8px; padding: 12px; flex: 1; text-align: center; }
    .drawer-stat-value { font-size: 1.2rem; font-weight: 700; color: #00d4aa; }
    .drawer-stat-label { font-size: 0.65rem; color: #666; margin-top: 2px; }
    
    .reports-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
    .reports-table th { text-align: left; padding: 8px; color: #666; font-weight: 500; border-bottom: 1px solid #1e1e2e; }
    .reports-table td { padding: 8px; border-bottom: 1px solid #1a1a25; }
    .reports-table tr:hover { background: #1a1a25; }
    
    .serious-yes { color: #ff6b6b; }
    .serious-no { color: #00d4aa; }
    .outcome-fatal { color: #ff6b6b; font-weight: 600; }
    .outcome-recovered { color: #00d4aa; }
    
    .drawer-footer { padding: 16px 20px; border-top: 1px solid #1e1e2e; background: #0a0a0f; font-size: 0.7rem; color: #555; }
    
    .loading { text-align: center; padding: 60px; color: #666; }
    .spinner { width: 36px; height: 36px; border: 3px solid #1e1e2e; border-top-color: #00d4aa; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    footer { text-align: center; padding: 30px 20px; color: #333; font-size: 0.75rem; }
    footer a { color: #00d4aa; text-decoration: none; }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">EVE Medical Evidence</div>
      <div class="subtitle">Verified Adverse Event Data from FDA FAERS</div>
      <div class="badges">
        <span class="badge patent">üîí Patent Pending EVE-PAT-2026-001</span>
        <span class="badge verified" id="corpusBadge">Loading...</span>
      </div>
    </header>
    
    <div class="stats-bar" id="statsBar">
      <div class="stats-item"><div class="stats-value" id="totalSubstances">-</div><div class="stats-label">Substances</div></div>
      <div class="stats-item"><div class="stats-value" id="totalEvents">-</div><div class="stats-label">Events</div></div>
      <div class="stats-item"><div class="stats-value" id="totalAreas">-</div><div class="stats-label">Therapeutic Areas</div></div>
      <div class="stats-item"><div class="stats-value" id="corpusVersion">-</div><div class="stats-label">Corpus Version</div></div>
    </div>
    
    <!-- Master View -->
    <div class="master-view" id="masterView">
      <div class="master-header">
        <div>
          <div class="master-title">All Substances</div>
          <div class="master-subtitle">Click a substance to explore detailed, deterministic evidence</div>
        </div>
        <div class="filters">
          <div class="filter-group">
            <span class="filter-label">Area:</span>
            <select id="filterArea" onchange="applyFilters()">
              <option value="">All Areas</option>
              <option value="A">A - Metabolism/Diabetes</option>
              <option value="C">C - Cardiovascular</option>
              <option value="N">N - CNS/Psychiatry</option>
              <option value="M">M - Pain/Inflammation</option>
              <option value="J">J - Anti-infectives</option>
              <option value="R">R - Respiratory/Allergy</option>
            </select>
          </div>
          <div class="filter-group">
            <span class="filter-label">Sort:</span>
            <select id="sortBy" onchange="applyFilters()">
              <option value="drug">Name</option>
              <option value="events">Events</option>
            </select>
          </div>
        </div>
      </div>
      <table class="substances-table">
        <thead><tr><th>Substance</th><th>Therapeutic Area</th><th>Events</th><th>Status</th></tr></thead>
        <tbody id="substancesBody"></tbody>
      </table>
    </div>
    
    <!-- Detail View -->
    <div class="detail-view" id="detailView">
      <button class="back-button" onclick="showMaster()">‚Üê Back to all substances</button>
      <div class="detail-card">
        <div class="detail-header">
          <div class="detail-title"><span class="atc-badge" id="detailAtc">A</span><span id="detailDrugName">Drug Name</span></div>
          <div class="detail-meta"><div id="detailProcessingTime">-</div><div>Trinity Level 1</div></div>
        </div>
        <div class="detail-body">
          <div class="detail-stats">
            <div class="detail-stat"><div class="detail-stat-value" id="detailEvents">-</div><div class="detail-stat-label">Events in Corpus</div></div>
            <div class="detail-stat"><div class="detail-stat-value" id="detailTotalFda">-</div><div class="detail-stat-label">Total in FDA</div></div>
            <div class="detail-stat"><div class="detail-stat-value" id="detailSerious">-</div><div class="detail-stat-label">% Serious</div></div>
            <div class="detail-stat"><div class="detail-stat-value fatal" id="detailFatal">-</div><div class="detail-stat-label">Fatal Outcomes</div></div>
          </div>
          <div class="charts-grid">
            <div class="chart-card"><div class="chart-title">‚ö†Ô∏è Seriousness</div><div class="bar-chart" id="seriousChart"></div></div>
            <div class="chart-card"><div class="chart-title">üë• Sex Distribution</div><div class="bar-chart" id="sexChart"></div></div>
            <div class="chart-card"><div class="chart-title">üìä Age Distribution</div><div class="bar-chart" id="ageChart"></div></div>
            <div class="chart-card"><div class="chart-title">üè• Outcomes</div><div class="bar-chart" id="outcomeChart"></div></div>
          </div>
          <p class="stats-disclaimer" id="detailStatsDisclaimer"></p>
          <div class="reactions-section">
            <div class="section-title">Top Reported Reactions <span style="font-weight:400;color:#666">(click to view reports)</span></div>
            <div class="reaction-list" id="detailReactions"></div>
          </div>
          <div class="verification-section">
            <div class="section-title">üîê Verification Data</div>
            <div class="hash-display">
              <span class="hash-label">Corpus Version:</span> <span id="detailCorpusVersion"></span><br>
              <span class="hash-label">Root Hash:</span> <span id="detailRootHash"></span><br>
              <span class="hash-label">Stats Hash:</span> <span id="detailStatsHash"></span>
            </div>
          </div>
          <div class="disclaimer">‚ö†Ô∏è This output reports adverse events from FDA FAERS. It does not constitute medical advice.</div>
        </div>
      </div>
    </div>
    
    <!-- Loading -->
    <div class="master-view" id="loadingView"><div class="loading"><div class="spinner"></div><div>Loading corpus...</div></div></div>
  </div>
  
  <!-- Drawer Overlay -->
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  
  <!-- Drawer -->
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <div>
        <div class="drawer-title" id="drawerTitle">Reaction: Pain</div>
        <div class="drawer-subtitle" id="drawerSubtitle">Drug: Ibuprofen ¬∑ Corpus: v20260131-01</div>
      </div>
      <button class="drawer-close" onclick="closeDrawer()">√ó</button>
    </div>
    <div class="drawer-body">
      <div class="drawer-stats">
        <div class="drawer-stat"><div class="drawer-stat-value" id="drawerTotal">-</div><div class="drawer-stat-label">Total in Corpus</div></div>
        <div class="drawer-stat"><div class="drawer-stat-value" id="drawerFiltered">-</div><div class="drawer-stat-label">With This Reaction</div></div>
      </div>
      <table class="reports-table">
        <thead><tr><th>Report ID</th><th>Serious</th><th>Age</th><th>Sex</th><th>Outcome</th></tr></thead>
        <tbody id="drawerReports"></tbody>
      </table>
    </div>
    <div class="drawer-footer">
      <span class="hash-label">Status:</span> VERIFIED ¬∑ Filtered from same snapshot ¬∑ No new calculations<br>
      <span class="hash-label">Root Hash:</span> <span id="drawerRootHash">-</span>
    </div>
  </div>
  
  <footer>
    <p>EVE Medical Evidence ¬∑ Snapshot v20260131-01 ¬∑ 36 Substances ¬∑ 6 Therapeutic Areas</p>
    <p style="margin-top: 6px;"><a href="http://localhost:3050/corpus" target="_blank">View Corpus API</a> ¬∑ <a href="http://localhost:3050/proof/v20260131-01" target="_blank">View Merkle Proof</a></p>
    <p style="margin-top: 12px;">¬© 2026 Organiq Sweden AB</p>
  </footer>

  <script>
    const API_URL = 'http://localhost:3050';
    let allDrugs = [];
    let corpusData = null;
    let currentDrug = null;
    
    async function loadCorpus() {
      try {
        const res = await fetch(`${API_URL}/corpus`);
        corpusData = await res.json();
        allDrugs = corpusData.drugs || [];
        document.getElementById('corpusBadge').textContent = `‚úì Verified: ${corpusData.version}`;
        document.getElementById('totalSubstances').textContent = corpusData.total_substances;
        document.getElementById('totalEvents').textContent = corpusData.total_events.toLocaleString();
        document.getElementById('totalAreas').textContent = corpusData.therapeutic_areas;
        document.getElementById('corpusVersion').textContent = corpusData.version;
        applyFilters();
        document.getElementById('loadingView').classList.add('hidden');
        document.getElementById('masterView').classList.remove('hidden');
      } catch (err) {
        document.getElementById('loadingView').innerHTML = `<div class="loading"><div style="color: #ff6b6b;">Failed to connect to API</div></div>`;
      }
    }
    
    function applyFilters() {
      const areaFilter = document.getElementById('filterArea').value;
      const sortBy = document.getElementById('sortBy').value;
      let filtered = [...allDrugs];
      if (areaFilter) filtered = filtered.filter(d => d.atc_code === areaFilter);
      filtered.sort((a, b) => sortBy === 'drug' ? a.drug.localeCompare(b.drug) : b.events - a.events);
      renderTable(filtered);
    }
    
    function renderTable(drugs) {
      document.getElementById('substancesBody').innerHTML = drugs.map(d => `
        <tr onclick="showDetail('${d.drug}')">
          <td><span class="atc-badge atc-${d.atc_code || 'A'}">${d.atc_code || '?'}</span><span class="drug-name">${d.drug}</span></td>
          <td style="color: #666; font-size: 0.8rem;">${d.therapeutic_area || '-'}</td>
          <td>${d.events}</td>
          <td><span class="verified-badge">VERIFIED</span></td>
        </tr>
      `).join('');
    }
    
    async function showDetail(drugName) {
      currentDrug = drugName;
      document.getElementById('masterView').classList.add('hidden');
      document.getElementById('detailView').classList.add('active');
      
      const res = await fetch(`${API_URL}/query`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ query: drugName }) });
      const data = await res.json();
      if (data.status !== 'VERIFIED') { alert('Failed'); showMaster(); return; }
      
      const drugInfo = allDrugs.find(d => d.drug.toLowerCase() === drugName.toLowerCase());
      const atcCode = drugInfo?.atc_code || '?';
      
      document.getElementById('detailAtc').textContent = atcCode;
      document.getElementById('detailAtc').className = `atc-badge atc-${atcCode}`;
      document.getElementById('detailDrugName').textContent = data.drug;
      document.getElementById('detailProcessingTime').textContent = `${data.processing_time_ms}ms`;
      document.getElementById('detailEvents').textContent = data.summary.total_events;
      document.getElementById('detailTotalFda').textContent = data.summary.total_in_fda.toLocaleString();
      
      const stats = data.stats;
      if (stats) {
        const serious = stats.seriousness.serious, nonSerious = stats.seriousness.non_serious;
        const seriousPercent = serious + nonSerious > 0 ? Math.round((serious / (serious + nonSerious)) * 100) : 0;
        document.getElementById('detailSerious').textContent = `${seriousPercent}%`;
        document.getElementById('detailFatal').textContent = stats.outcome_distribution['Fatal'] || 0;
        renderBarChart('seriousChart', { 'Serious': serious, 'Non-Serious': nonSerious }, { 'Serious': 'serious', 'Non-Serious': 'non-serious' });
        renderBarChart('sexChart', stats.sex_distribution, { 'Male': 'male', 'Female': 'female', 'Unknown': 'unknown' });
        renderBarChart('ageChart', stats.age_distribution, {});
        renderBarChart('outcomeChart', stats.outcome_distribution, { 'Fatal': 'fatal', 'Recovered/Resolved': 'recovered' });
      }
      
      document.getElementById('detailStatsDisclaimer').textContent = data.stats_disclaimer || '';
      
      // Reactions - now clickable!
      document.getElementById('detailReactions').innerHTML = (data.summary.top_reactions || []).slice(0, 10).map(r => 
        `<span class="reaction-tag" onclick="openReactionDrawer('${data.drug}', '${r.reaction.replace(/'/g, "\\'")}', ${r.count})">${r.reaction}<span class="reaction-count">${r.count}</span></span>`
      ).join('');
      
      document.getElementById('detailCorpusVersion').textContent = data.corpus_version;
      document.getElementById('detailRootHash').textContent = data.root_hash;
      document.getElementById('detailStatsHash').textContent = data.stats_hash || 'N/A';
    }
    
    function showMaster() {
      document.getElementById('detailView').classList.remove('active');
      document.getElementById('masterView').classList.remove('hidden');
    }
    
    async function openReactionDrawer(drug, reaction, count) {
      document.getElementById('drawerOverlay').classList.add('open');
      document.getElementById('drawer').classList.add('open');
      document.getElementById('drawerTitle').textContent = `Reaction: ${reaction}`;
      document.getElementById('drawerSubtitle').textContent = `Drug: ${drug} ¬∑ Corpus: ${corpusData.version}`;
      document.getElementById('drawerReports').innerHTML = '<tr><td colspan="5" style="text-align:center;color:#666;">Loading...</td></tr>';
      
      const res = await fetch(`${API_URL}/query/reaction`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ drug, reaction }) });
      const data = await res.json();
      
      if (data.status !== 'VERIFIED') {
        document.getElementById('drawerReports').innerHTML = '<tr><td colspan="5" style="color:#ff6b6b;">Error loading data</td></tr>';
        return;
      }
      
      document.getElementById('drawerTotal').textContent = data.total_events_in_corpus;
      document.getElementById('drawerFiltered').textContent = data.filtered_count;
      document.getElementById('drawerRootHash').textContent = data.root_hash.slice(0, 24) + '...';
      
      document.getElementById('drawerReports').innerHTML = data.reports.map(r => `
        <tr>
          <td style="font-family:monospace;font-size:0.7rem;">${r.report_id}</td>
          <td class="${r.serious === 'Yes' ? 'serious-yes' : 'serious-no'}">${r.serious}</td>
          <td>${r.age}</td>
          <td>${r.sex}</td>
          <td class="${r.outcome === 'Fatal' ? 'outcome-fatal' : r.outcome.includes('Recovered') ? 'outcome-recovered' : ''}">${r.outcome}</td>
        </tr>
      `).join('');
    }
    
    function closeDrawer() {
      document.getElementById('drawerOverlay').classList.remove('open');
      document.getElementById('drawer').classList.remove('open');
    }
    
    function renderBarChart(containerId, data, classMap) {
      const container = document.getElementById(containerId);
      const entries = Object.entries(data).filter(([k, v]) => v > 0);
      const max = Math.max(...entries.map(([k, v]) => v), 1);
      container.innerHTML = entries.map(([label, value]) => {
        const percent = (value / max) * 100;
        const barClass = classMap[label] || 'default';
        return `<div class="bar-row"><div class="bar-label">${label}</div><div class="bar-container"><div class="bar-fill ${barClass}" style="width: ${percent}%"></div><span class="bar-value ${percent < 15 ? 'outside' : ''}">${value}</span></div></div>`;
      }).join('');
    }
    
    loadCorpus();
  </script>
</body>
</html>
